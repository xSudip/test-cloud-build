name: Terraform

on:
  workflow_dispatch:
    inputs:
      Action:
        type: choice
        description: Choose the Terraform Action
        options: 
        - PLAN
        - APPLY


jobs:
  terraform:
    name: 'Terraform Init'
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
        working-directory: ./test
    steps:
        - name: Checkout
          uses: actions/checkout@v3

        - name: Setup Terraform
          uses: hashicorp/setup-terraform@v1
        
        - name: Terraform Plan
          run: |
            terraform init
            terraform plan
          env:
            GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_KEY }}


  terraform-apply:
    name: 'Terraform Apply'
    runs-on: ubuntu-latest
    environment: production
    defaults:
      run:
        shell: bash
        working-directory: ./test
    steps:
        - name: Checkout
          uses: actions/checkout@v3
        
        - name: Setup Terraform
          uses: hashicorp/setup-terraform@v1
        
        - name: Terraform Apply
          run: |
            terraform init
            terraform apply
          env:
            GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_KEY }}
            